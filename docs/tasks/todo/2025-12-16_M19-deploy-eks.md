---
id: "2025-12-16_M19-deploy-eks"
title: "M19 Déploiement application sur EKS"
type: feature
area: devops
agents_required: [devops]
depends_on: ["2025-12-16_M18-eks-skeleton", "2025-12-16_M17-ecr-build"]
validated_by:
validated_at:
---

## Contexte
Le cluster EKS et les images ECR sont prévus par les tickets précédents. Il faut fournir les manifests/Helm charts pour déployer l’API (et, si faisable, le front) sur EKS avec configuration sécurisée.

## Objectif
Disposer d’un déploiement Kubernetes prêt pour EKS : Deployment/Service/Ingress/ConfigMap/Secret paramétrables, utilisant les images ECR et avec healthchecks configurés.

## Hors scope
- Création du cluster ou du registre (M18/M17).
- Observabilité avancée (M20) ou gestion des secrets managée (M21).
- Migration base de données/DB bootstrap (si non existant sur le cluster).

## Scope technique
- Manifests Kubernetes ou chart Helm pour l’API (web optionnel, si clair dans la doc) dans `k8s/` ou `charts/`.
- Configuration des images ECR (tag/digest), variables d’environnement, secrets (références à Secret/SSM/SealedSecrets, pas de clair).
- Ingress/Service/ConfigMap/Secret, readiness/liveness probes, autoscaling optionnel si simple.
- Documentation des commandes de déploiement (kubectl/helm) avec placeholders pour compte/région/ECR/hostnames.

## Contraintes
- Aucun secret en clair ; secrets injectés via Kubernetes Secrets ou référence externe documentée.
- Healthchecks (readiness/liveness) activés ; ressources (requests/limits) par défaut raisonnables.
- Paramétrage par environnement (dev/preprod/prod) possible via valeurs ou kustomize overlays.

## Deliverables
- Manifests ou chart Helm pour déployer l’API (et mention explicite si le front est inclus ou exclu) sur EKS.
- Fichiers de configuration par environnement (overlays/values) avec variables ECR/hostnames.
- Documentation pas-à-pas pour déployer/mettre à jour/rollback (kubectl/helm).

## Critères d’acceptation
- [ ] `kubectl apply --dry-run=client -k <overlay_eks>` (ou `helm template --validate`) fonctionne et référence l’image ECR via tag/digest.
- [ ] Les probes readiness/liveness sont présentes et utilisent les endpoints de santé de l’API.
- [ ] Les secrets/configs sont injectés sans texte en clair dans Git (placeholders ou références à un store sécurisé).
- [ ] La documentation décrit les commandes de déploiement et de rollback avec les variables à renseigner (namespace, host, image tag).

## Comment tester
1) Préparer un kubeconfig pointant vers le cluster de test (ou utiliser `--dry-run=client`).
2) `kubectl apply --dry-run=client -k k8s/overlays/eks-dev` (ou chemin documenté) et vérifier l’image référencée (ECR tag/digest).
3) `kubectl -n booking get deployment api -o yaml | grep image:` pour confirmer le tag/digest ECR.
4) `kubectl -n booking describe deployment api` pour vérifier les probes readiness/liveness.
5) Suivre la procédure de rollback documentée (ex: `kubectl rollout undo deployment/api`) sur un cluster de test ou en simulation.

## Plan
1) Structurer les manifests/Helm (Deployment, Service, Ingress, ConfigMap/Secret) avec variables ECR/hostnames/environnement.
2) Ajouter les probes et ressources par défaut ; prévoir des overlays/values par environnement.
3) Documenter les commandes kubectl/helm pour déployer, vérifier et rollback, en précisant les variables à renseigner.

## À contrôler
- S’assurer que le front est explicitement inclus ou exclu dans la doc pour éviter l’ambiguïté.
- Vérifier la compatibilité avec l’Ingress (hostname/cert) et le namespace attendu.
- Contrôler que les secrets ne sont pas commités et que les instructions de déploiement mentionnent leur provisionnement.
